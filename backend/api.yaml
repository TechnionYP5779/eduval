openapi: 3.0.1
info:
  title: EMon API
  version: 1.0.0
servers:
  - url: 'https://api.emon-teach.com'
tags:
  - name: user
    description: deals with generic users
  - name: teacher
    description: stuff related to the teachers
  - name: student
    description: stuff related to the students
  - name: course
    description: course stuff
  - name: log
    description: emon transaction stuffz
  - name: lesson
    description: |
      What you use during an actual lesson.
      
      In addition to these functions, you will also subscribe to [MQTT topics](https://www.hivemq.com/blog/mqtt-essentials-part-5-mqtt-topics-best-practices/) to receive live updates.  
      The clients should only *subscribe*. Sending messages is handled by the API calls below.  
      The content of the notifications is the same as the corresponding API call.
      
      There are several topics groups, which are fairly similar to the API endpoints:
      * ``lesson/{courseId}/status`` - A message will be published here when the lesson starts/ends.
      * ``lesson/{courseId}/messages/{studentId}`` - Any messages sent to a student will be published here.
      * ``lesson/{courseId}/students`` - Messages about students connecting will be sent here.
      * ``lesson/{courseId}/teacherMessages`` - Any messages sent to the teacher will be published here.
      
      IMPORTANT: Please note there is no leading slash (``/``) at the beginning of topic names.  
      Also remember that you can use wildcards.
  - name: shop
    description: stuff related to the item shop
  - name: demo
    description: stuff related to demo lessons

paths:
  '/user/{userId}':
    put:
      tags:
        - user
      summary: Update a users's profile
      description: Updates a user's profile, including password.
      parameters:
        - name: userId
          in: path
          description: ID of user
          required: true
          schema:
            type: string
      requestBody:
        description: >-
          The fields to update. `oldPassword` required, the rest are optional.


          In case of demo user, no old password is required, but a new one *must* be set. This status is lost after the first update.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserDetails'
      responses:
        '200':
          description: successful operation
          content: {}
        '401':
          description: Trying to edit a different user
          content: {}
        '400':
          description: JSON validation error / Invalid ID / missing new password for demo user.
          content: {}
        '404':
          description: User not found
          content: {}
        '403':
          description: Incorrect password
          content: {}
        '429':
          description: Too many attempts. Account blocked.
          content: {}
      security:
        - auth0_token: []
 
  '/teacher/{teacherId}/activeLesson':
    get:
      tags:
        - teacher
      summary: Return the taught course
      description: Returns the lesson the teacher is teaching right now.
      parameters:
        - name: teacherId
          in: path
          description: ID of teacher to return
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: integer
                format: int64
                description: The ID of the course being taught.
        '204':
          description: No content. The request is valid, but there is no course being taught.
        '400':
          description: Validation exception. Invalid ID.
          content: {}
        '404':
          description: Teacher not found
          content: {}
      security:
        - auth0_token: [] 

  '/student/{studentId}/courseInventory/{courseId}':
    get:
      tags:
        - student
      summary: Get the course items a student owns
      description: Returns a list of all shop items a student has purchased in a single course.
      parameters:
        - name: studentId
          in: path
          description: ID of student
          required: true
          schema:
            type: string
        - name: courseId
          in: path
          description: ID of course
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OwnedItem'
        '400':
          description: Validation exception. Invalid ID.
          content: {}
        '404':
          description: Teacher not found
          content: {}
      security:
        - auth0_token: []
  '/student/{studentId}/courseInventory/{courseId}/useItem':
    post:
      tags:
        - student
      summary: Uses an item a student owns
      description: Uses an item in a student's inventory.
      parameters:
        - name: studentId
          in: path
          description: ID of student
          required: true
          schema:
            type: string
        - name: courseId
          in: path
          description: ID of course
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        description: ID of the item to use.
        content:
          application/json:
            schema:
              type: integer
      responses:
        '200':
          description: successful operation
          content: {}
        '400':
          description: Validation exception. Invalid ID.
          content: {}
        '404':
          description: Teacher not found
          content: {}
      security:
        - auth0_token: []
 
  '/student/{studentId}/activeLesson':
    get:
      tags:
        - student
      summary: Return the learned course
      description: Returns the lesson the student is studiying right now.
      parameters:
        - name: studentId
          in: path
          description: ID of student to return
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: integer
                format: int64
                description: The ID of the course being taught.
        '204':
          description: No content. The request is valid, but there is no course being taught.
        '400':
          description: Validation exception. Invalid ID.
          content: {}
        '404':
          description: Teacher not found
          content: {}
      security:
        - auth0_token: []
  
  '/student/{studentId}/emonBalance/byCourse/{courseId}':
    get:
      tags:
        - student
      summary: Find course by ID
      description: Returns a student's emon balance in a certain course
      parameters:
        - name: studentId
          in: path
          description: ID of the relevant student
          required: true
          schema:
            type: integer
            format: int64
        - name: courseId
          in: path
          description: ID of the requested course
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: successful operation
          content:
            text/plain:
              schema:
                type: integer
                format: int64
                example: 15
        '400':
          description: Validation exception. Invalid ID(s).
          content: {}
        '404':
          description: Course not found
          content: {}
      security:
        - auth0_token: []

  
  /course:
    put:
      tags:
        - course
      summary: Update an existing course
      requestBody:
        description: >-
          Course object that needs to be updated. ID is required.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Course'
        required: true
      responses:
        '200':
          description: All OK
          content: {}
        '404':
          description: Course not found
          content: {}
        '400':
          description: Validation exception. Invalid JSON.
          content: {}
      security:
        - auth0_token: []
    post:
      tags:
        - course
      summary: Add a new course
      requestBody:
        description: Course object that needs to be added. ID field is optional and is ignored.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Course'
        required: true
      responses:
        '200':
          description: All OK
          content: 
            text/plain:
              schema:
                type: integer
                format: int64
                example: 15
                description: 'ID of inserted course'
        '400':
          description: Validation exception. Invalid JSON.
          content: {}
      security:
        - auth0_token: []
  
  '/course/{courseId}':
    get:
      tags:
        - course
      summary: Find course by ID
      description: Returns a single course
      parameters:
        - name: courseId
          in: path
          description: ID of course to return
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Course'
        '400':
          description: Validation exception. Invalid ID.
          content: {}
        '404':
          description: Course not found
          content: {}
      security:
        - auth0_token: []
    delete:
      tags:
        - course
      summary: Deletes a course
      description: >-
        Deletes __*everything*__ related to the course. Registered student records, shop items, emons. Irreversible.  
        
        <img src="https://media.tenor.com/images/0b60c301b5209c27fd98ebbb489c87c9/tenor.gif"/>
      parameters:
        - name: courseId
          in: path
          description: ID of course to delete
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: All OK
          content: {}
        '400':
          description: Validation exception. Invalid ID.
          content: {}
        '404':
          description: Course not found
          content: {}
      security:
        - auth0_token: []
  
  '/course/{courseId}/registered':
    get:
      tags:
        - course
      summary: Get registered students
      
      description: Returns the registered students list
      parameters:
        - name: courseId
          in: path
          description: ID of the relevant course
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: All OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Student'
        '400':
          description: Validation exception. Invalid ID.
          content: {}
        '404':
          description: No such course
          content: {}
      security:
        - auth0_token: []
    post:
      tags:
        - course
      summary: Register students to a course
      
      description: >-
        Adds students to the registered students list.
      parameters:
        - name: courseId
          in: path
          description: ID of the relevant course
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        description: Array of student emails that should be registered.
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                format: email
        required: true
      responses:
        '200':
          description: All OK
          content: {}
        '400':
          description: Validation exception. Invalid ID/JSON.
          content: {}
      security:
        - auth0_token: []

  '/course/{courseId}/registered/emons':
    get:
      tags:
        - course
      summary: Get registered students with their monies
      
      description: Returns the registered students list and how much Emons they earned.
      parameters:
        - name: courseId
          in: path
          description: ID of the relevant course
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: All OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StudentWithEmons'
        '400':
          description: Validation exception. Invalid ID.
          content: {}
        '404':
          description: No such course
          content: {}
      security:
        - auth0_token: []
    

  '/course/{courseId}/registered/{studentId}':
    delete:
      tags:
        - course
      summary: Delete a student from a course
      
      description: Removes a student from the registered students list
      parameters:
        - name: courseId
          in: path
          description: ID of the relevant course
          required: true
          schema:
            type: integer
            format: int64
        - name: studentId
          in: path
          description: ID of the student
          required: true
          schema:
            type: string
      responses:
        '200':
          description: All OK
          content: {}
        '400':
          description: Validation exception. Invalid ID(s).
          content: {}
        '404':
          description: No such registration pair
          content: {}
      security:
        - auth0_token: []
  
  '/course/{courseId}/purchasedItems':
    get:
      tags:
        - course
      summary: Get the items that students bought in this course
      
      description: Returns a list of all the items from this course that were purchased and used.
      parameters:
        - name: courseId
          in: path
          description: ID of the relevant course
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: All OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ItemWithStudents'
        '400':
          description: Validation exception. Invalid ID.
          content: {}
        '404':
          description: No such course
          content: {}
      security:
        - auth0_token: []
  
  '/course/byTeacher/{teacherId}':
    get:
      tags:
        - course
      summary: Find all courses by a teacher
      description: Returns an array of courses
      parameters:
        - name: teacherId
          in: path
          description: ID of the teacher
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Course'
        '400':
          description: Validation exception. Invalid ID.
          content: {}
        '404':
          description: Teacher not found
          content: {}
      security:
        - auth0_token: []
  
  '/course/byStudent/{studentId}':
    get:
      tags:
        - course
      summary: Find all courses that a student is taking
      description: Returns an array of courses
      parameters:
        - name: studentId
          in: path
          description: ID of the student
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Course'
        '400':
          description: Validation exception. Invalid ID.
          content: {}
        '404':
          description: Student not found
          content: {}
      security:
        - auth0_token: []

  
  '/log/ofStudent/{studentId}/byCourse/{courseId}':
    get:
      tags:
        - log
      summary: Get the transaction log
      description: Returns the transaction log of a student in a course
      parameters:
        - name: studentId
          in: path
          description: ID of the relevant student
          required: true
          schema:
            type: string
        - name: courseId
          in: path
          description: ID of the requested course
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Log'
        '400':
          description: Validation exception. Invalid ID(s).
          content: {}
        '404':
          description: Course not found
          content: {}
      security:
        - auth0_token: []
  
  '/log/condensed/{studentId}/byCourse/{courseId}':
    get:
      tags:
        - log
      summary: Get a condensed log
      description: Returns a log of a student in a course, summed up per lesson.
      parameters:
        - name: studentId
          in: path
          description: ID of the relevant student
          required: true
          schema:
            type: string
        - name: courseId
          in: path
          description: ID of the requested course
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LessonLog'
        '400':
          description: Validation exception. Invalid ID(s).
          content: {}
        '404':
          description: Course not found
          content: {}
      security:
        - auth0_token: []
  
  '/log/course/{courseId}/awardedEmons':
    get:
      tags:
        - log
      summary: See who's getting da money
      description: Returns how much Emons students got in this course in total. 
      parameters:
        - name: courseId
          in: path
          description: ID of the requested course
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalEmons:
                    type: integer
                  students:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        name:
                          type: string
                        emons:
                          type: integer
        '400':
          description: Validation exception. Invalid ID(s).
          content: {}
        '404':
          description: Course not found
          content: {}
      security:
        - auth0_token: []
        
  '/log/teacher/{teacherId}/awardedEmons':
    get:
      tags:
        - log
      summary: See who's getting da money
      description: Returns how much Emons students got from this teacher in total. 
      parameters:
        - name: teacherId
          in: path
          description: ID of the relevant teacher
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalEmons:
                    type: integer
                  students:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        name:
                          type: string
                        emons:
                          type: integer
        '400':
          description: Validation exception. Invalid ID(s).
          content: {}
        '404':
          description: Course not found
          content: {}
      security:
        - auth0_token: []
  
  
  
  '/lesson/{courseId}/status':
    get:
      tags:
        - lesson
      summary: Get the status of a lesson
      
      parameters:
        - name: courseId
          in: path
          description: The ID of the lesson's course
          required: true
          schema:
            type: integer
            format: int64
        
      responses:
        '200':
          description: All OK
          content:
            text/plain:
              schema:
                type: string
                enum:
                  - LESSON_START
                  - LESSON_END
        '404':
          description: Course not found
          content: {}
        '400':
          description: Validation exception. Invalid ID.
          content: {}
      security:
        - auth0_token: []
    post:
      tags:
        - lesson
      summary: Start or end a lesson
      
      description: >-
        Start or end a lesson by changing its status to `LESSON_START` or `LESSON_END`.
        
        
        If the requested new status is the same as the old one, nothing is performed.
      
      parameters:
        - name: courseId
          in: path
          description: The ID of the lesson's course
          required: true
          schema:
            type: integer
            format: int64
            
      requestBody:
        description: >-
          A string describing the new status.
        content:
          application/json:
            schema:
              type: string
              enum:
                - LESSON_START
                - LESSON_END
        required: true
        
      responses:
        '200':
          description: All OK
          content: {}
        '404':
          description: Course not found
          content: {}
        '400':
          description: Validation exception. Invalid ID/status.
          content: {}
      security:
        - auth0_token: []
  
  '/lesson/{courseId}/messages/{studentId}':
    get:
      tags:
        - lesson
      summary: Get the student's messages
      description: Returns all the messages a student got during this lesson
      parameters:
        - name: courseId
          in: path
          description: ID of the lesson's course
          required: true
          schema:
            type: integer
            format: int64
        - name: studentId
          in: path
          description: ID of the requested student
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Message'
        '400':
          description: Validation exception. Invalid ID(s).
          content: {}
        '404':
          description: Course not found
          content: {}
      security:
        - auth0_token: []
    post:
      tags:
        - lesson
      summary: Send a message to a student
      parameters:
        - name: courseId
          in: path
          description: The ID of the lesson's course
          required: true
          schema:
            type: integer
            format: int64
        - name: studentId
          in: path
          description: ID of the student
          required: true
          schema:
            type: string
      requestBody:
        description: The message to send.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Message'
        required: true
      responses:
        '200':
          description: All OK
          content: {}
        '404':
          description: Course not found
          content: {}
        '400':
          description: Validation exception. Invalid ID(s)/JSON.
          content: {}
      security:
        - auth0_token: []
    delete:
      tags:
        - lesson
      summary: Clear a student's messages
      description: At the end of the lesson, clear all messages from the student's table. This is so next lesson they can have a clear slate.
      parameters:
        - name: courseId
          in: path
          description: The ID of the lesson's course
          required: true
          schema:
            type: integer
            format: int64
        - name: studentId
          in: path
          description: ID of the student
          required: true
          schema:
            type: string
      responses:
        '200':
          description: All OK
          content: {}
        '404':
          description: Course not found
          content: {}
        '400':
          description: Validation exception. Invalid ID(s).
          content: {}
      security:
        - auth0_token: []


  '/lesson/{courseId}/present':
    get:
      tags:
        - lesson
      summary: Get a list of present students
      parameters:
        - name: courseId
          in: path
          description: The ID of the lesson's course
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: All OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StudentWithDesk'
        '404':
          description: Course not found
          content: {}
        '405':
          description: Invalid ID
          content: {}
      security:
        - auth0_token: []
    post:
      tags:
        - lesson
      summary: Mark a student as present
      parameters:
        - name: courseId
          in: path
          description: The ID of the lesson's course
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        description: The student's ID and desk.
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  description: The ID of the student
                desk:
                  type: string
        required: true
      responses:
        '200':
          description: All OK
          content: {}
        '404':
          description: Course not found
          content: {}
        '409':
          description: Desk already taken 
          content: {}
        '405':
          description: Invalid ID
          content: {}
      security:
        - auth0_token: []
  
  '/lesson/{courseId}/teacherMessages':
    get:
      tags:
        - lesson
      summary: Get the messages sent to the teacher
      description: Returns all the messages the teacher got during this lesson from students.
      parameters:
        - name: courseId
          in: path
          description: ID of the lesson's course
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TeacherMessage'
        '400':
          description: Validation exception. Invalid ID.
          content: {}
        '404':
          description: Course not found
          content: {}
      security:
        - auth0_token: []
    post:
      tags:
        - lesson
      summary: Send a message to the teacher
      parameters:
        - name: courseId
          in: path
          description: The ID of the lesson's course
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        description: The message to send.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TeacherMessage'
        required: true
      responses:
        '200':
          description: All OK
          content: {}
        '404':
          description: Course not found
          content: {}
        '400':
          description: Validation exception. Invalid ID/JSON.
          content: {}
      security:
        - auth0_token: []
    delete:
      tags:
        - lesson
      summary: Clear the teacher's messages
      description: At the end of the lesson, clear all messages the teacher got. This is so next lesson they can have a clear slate.
      parameters:
        - name: courseId
          in: path
          description: The ID of the lesson's course
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: All OK
          content: {}
        '404':
          description: Course not found
          content: {}
        '400':
          description: Validation exception. Invalid ID.
          content: {}
      security:
        - auth0_token: []
 
  '/lesson/{courseId}/teacherMessages/{messageType}':
    delete:
      tags:
        - lesson
      summary: Clear the teacher's messages
      description: At the end of the lesson, clear all messages the teacher got. This is so next lesson they can have a clear slate.
      parameters:
        - name: courseId
          in: path
          description: The ID of the lesson's course
          required: true
          schema:
            type: integer
            format: int64
        - name: messageType
          in: path
          description: The type of message to clear
          required: true
          schema:
            type: string
            enum: [MESSAGE_CONFUSED, MESSAGE_QUESTION, MESSAGE_NEED_TO_LEAVE, MESSAGE_ANSWER, MESSAGE_LOUDER]
      responses:
        '200':
          description: All OK
          content: {}
        '404':
          description: Course not found
          content: {}
        '400':
          description: Validation exception. Invalid ID.
          content: {}
      security:
        - auth0_token: []
 
  '/lesson/{courseId}/awardedEmons':
    get:
      tags:
        - lesson
      summary: Get a list of Emons awarded to students
      description: Get all Emons awarded per student in current lesson.
      parameters:
        - name: courseId
          in: path
          description: The ID of the lesson's course
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: All OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StudentIdWithEmons'
        '404':
          description: Course not found
          content: {}
        '405':
          description: Invalid ID
          content: {}
      security:
        - auth0_token: []
  
  '/shop/{courseId}/items':
    get:
      tags:
        - shop
      summary: Get the items in a course's shop
      description: Returns all the itemsin the shop of a certain lesson.
      parameters:
        - name: courseId
          in: path
          description: ID of the shop's course
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ShopItem'
        '400':
          description: Validation exception. Invalid ID.
          content: {}
        '404':
          description: Course not found
          content: {}
      security:
        - auth0_token: []
    post:
      tags:
        - shop
      summary: Add an item to a shop
      parameters:
        - name: courseId
          in: path
          description: The ID of the shop's course
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        description: The item to add.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ShopItem'
        required: true
      responses:
        '200':
          description: All OK
          content: {}
        '404':
          description: Course not found
          content: {}
        '400':
          description: Validation exception. Invalid ID/JSON.
          content: {}
      security:
        - auth0_token: []
    put:
      tags:
        - shop
      summary: Update an existing item
      parameters:
        - name: courseId
          in: path
          description: The ID of the shop's course
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        description: >-
          Item object that needs to be updated. ID is required, rest is
          optional.
        content:
          application/json:
            schema:
                $ref: '#/components/schemas/ShopItem'
        required: true
      responses:
        '200':
          description: All OK
          content: {}
        '404':
          description: Item not found
          content: {}
        '400':
          description: Validation exception. Invalid JSON.
          content: {}
      security:
        - auth0_token: []
  
  '/shop/{courseId}/item/{itemId}':  
    delete:
      tags:
        - shop
      summary: Remove an item from a shop
      description: Remove an item from a course's shop.
      parameters:
        - name: courseId
          in: path
          description: The ID of the shop's course
          required: true
          schema:
            type: integer
            format: int64
        - name: itemId
          in: path
          description: The ID of the item to remove
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: All OK
          content: {}
        '404':
          description: Course not found
          content: {}
        '400':
          description: Validation exception. Invalid ID.
          content: {}
      security:
        - auth0_token: []
  '/shop/{courseId}/order':
    post:
      tags:
        - shop
      summary: Order an item
      parameters:
        - name: courseId
          in: path
          description: The ID of the shop's course
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        description: The item to purchase and its amount.
        content:
          application/json:
            schema:
              type: object
              properties:
                studentId:
                  type: string
                itemId:
                  type: integer
                  format: int64
                amount:
                  type: integer
                  format: int64
        required: true
      responses:
        '200':
          description: All OK
          content: {}
        '404':
          description: Course not found
          content: {}
        '400':
          description: Validation exception. Invalid ID/JSON.
          content: {}
      security:
        - auth0_token: []
  
  '/demo':
    post:
      tags:
        - demo
      summary: Add a new demo course
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Course'
        required: true
      responses:
        '200':
          description: All OK
          content: 
            text/plain:
              schema:
                type: string
                example: 'http://bit.ly/2U05Lzs'
                description: 'Invite link to the new course.'
        '400':
          description: Validation exception. Invalid JSON.
          content: {}
      security:
        - auth0_token: []
  
  '/demo/{demoHash}':
    get:
      tags:
        - demo
      summary: Get information about a demo course
      parameters:
        - name: demoHash
          in: path
          description: The ID hash of the requested demo course.
          required: true
          schema:
            type: string
      responses:
        '200':
          description: All OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Course'
      security:
        - auth0_token: []
  '/demo/{demoHash}/students':
    post:
      tags:
        - demo
      summary: Register a new student to a demo
      description: >-
        Performs the following:
          * Creates new Auth0 user & registers it as a student.
          * Logs it in.
          * Registers the student to the demo lesson.
          * Starts the demo lesson if needed and joins it as the new student.
      parameters:
        - name: demoHash
          in: path
          description: The ID hash of the requested demo course.
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                nickname:
                  type: string
                seatNumber:
                  type: integer
      responses:
        '200':
          description: All OK
          content:
            text/plain:
              schema:
                type: string
                example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c'
                description: 'Auth0 token of created user.'
        '409':
          description: Desk already taken, or demo lesson not started.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: The cause of the error
                    enum: ["COURSE_NOT_STARTED", "DESK_TAKEN", "NAME_TAKEN"]
      security:
        - auth0_token: []
  
components:
  schemas:
    Teacher:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        email:
          type: string
          format: email
        phoneNum:
          type: string
      required:
      - name
      additionalProperties: false
    
    Student:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        email:
          type: string
          format: email
        phoneNum:
          type: string

    StudentWithEmons:
      type: object
      properties:
        id:
          type: string
        authIdToken:
          type: string
        name:
          type: string
        email:
          type: string
          format: email
        phoneNum:
          type: string
        emons:
          type: integer

    StudentWithDesk:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        email:
          type: string
          format: email
        phoneNum:
          type: string
        desk:
          type: string
          
    Course:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        teacherId:
          type: string
        location:
          type: string
        description:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        demoLink:
          type: string
          format: url
          
    Message:
      oneOf:
        - type: object
          properties:
            messageType:
              type: string
              enum: ["EMON"]
            messageReason:
              type: string
              description: unused currently. used to point out the reason for awarding money.
            value:
              type: integer
              format: int64
              description: The amount of emon given.
        - type: object
          properties:
            messageType:
              type: string
              enum: ["EMOJI"]
            emojiType:
              type: string
              description: what emoji was sent
              enum: ["EMOJI_HAPPY", "EMOJI_THUMBS_UP", "EMOJI_ANGEL", "EMOJI_GRIN", "EMOJI_SHUSH", "EMOJI_ZZZ", "EMOJI_ANGRY", "EMOJI_THUMBS_DOWN"]
          
    TeacherMessage:
      type: object
      properties:
        studentId:
          type: integer
          format: int64
        messageType:
          type: string
          enum: ["MESSAGE"]
        content:
          type: string
          description: what message was sent
          enum: ['MESSAGE_CONFUSED', 'MESSAGE_QUESTION', 'MESSAGE_NEED_TO_LEAVE', 'MESSAGE_ANSWER', 'MESSAGE_LOUDER']
      
    Log:
      oneOf:
        - type: object
          properties:
            id:
              type: integer
              format: int64
            studentId:
              type: string
            courseId:
              type: integer
              format: int64
            lessonNumber:
              type: integer
              format: int64
              description: The lesson the emon was given in
            messageType:
              type: string
              enum: ["EMON"]
            time:
              type: string
              format: date-time
            value:
              type: integer
              format: int64
              description: The amount of emon given.
        - type: object
          properties:
            id:
              type: integer
              format: int64
            studentId:
              type: string
            item:
              type: integer
              format: int64
            messageType:
              type: string
              enum: ["PURCHASE"]
            time:
              type: string
              format: date-time
            cost:
              type: integer
              format: int64
              description: The amount of emon spent.
        - type: object
          properties:
            id:
              type: integer
              format: int64
            studentId:
              type: string
            courseId:
              type: integer
              format: int64
            lessonNumber:
              type: integer
              format: int64
              description: The lesson the emoji was given in
            messageType:
              type: string
              enum: ["EMOJI"]
            time:
              type: string
              format: date-time
            emojiType:
              type: string
              description: what emoji was sent
              enum: ["EMOJI_HAPPY", "EMOJI_THUMBS_UP", "EMOJI_ANGEL", "EMOJI_GRIN", "EMOJI_SHUSH", "EMOJI_ZZZ", "EMOJI_ANGRY", "EMOJI_THUMBS_DOWN"]
    
    LessonLog:
      type: object
      properties:
        emons:
          type: integer
        emojis:
          type: array
          items:
            type: string
            enum: ["EMOJI_HAPPY", "EMOJI_THUMBS_UP", "EMOJI_ANGEL", "EMOJI_GRIN", "EMOJI_SHUSH", "EMOJI_ZZZ", "EMOJI_ANGRY", "EMOJI_THUMBS_DOWN"]
    
    ShopItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        cost:
          type: integer
        amountAvailable:
          type: integer
        sellByDate:
          type: string
          format: date
      additionalProperties: false
      
    OwnedItem:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        amount:
          type: integer
        amountUsed:
          type: integer
        isActive:
          type: boolean
      additionalProperties: false
    ItemWithStudents:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
        students:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              name:
                type: string
              email:
                type: string
                format: email
              phoneNum:
                type: string
              amountPurchased:
                type: integer
              amountUsed:
                type: integer
      additionalProperties: false
    StudentIdWithEmons:
      type: object
      properties:
        studentId:
          type: string
        emons:
          type: integer
      additionalProperties: false
    
    UserDetails:
      type: object
      properties:
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
          format: email
        phoneNum:
          type: string
        oldPassword:
          type: string
          format: password
        newPassword:
          type: string
          format: password
      required:
        - oldPassword

 
  securitySchemes:
    auth0_token:
      type: http
      scheme: bearer
      bearerFormat: JWT 
